<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SISTEMA DE MANDO T√ÅCTICO - CHILE</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');

:root { 
    --tactical-green: #4df24d; 
    --dim-green: rgba(77, 242, 77, 0.15);
    --army-dark: #020602;
    --alert-amber: #ffb400;
    --danger-red: #ff3b3b;
    --admin-blue: #00f2ff;
}

body {
    background: var(--army-dark);
    color: var(--tactical-green);
    font-family: 'Share Tech Mono', monospace;
    margin: 0;
    display: flex;
    height: 100vh;
}

.sidebar {
    width: 260px;
    background: rgba(5, 10, 5, 0.9);
    border-right: 1px solid var(--dim-green);
    padding: 20px 0;
}

.menu-item {
    padding: 12px 25px;
    cursor: pointer;
}

.main-content {
    flex: 1;
    padding: 30px;
    overflow-y: auto;
}

#adminTools {
    display: none;
    border: 1px solid var(--danger-red);
    padding: 20px;
    margin-bottom: 30px;
}

.auth-input {
    background: black;
    border: 1px solid var(--tactical-green);
    color: var(--tactical-green);
    padding: 10px;
    width: 100%;
}

#loginScreen {
    position: fixed;
    inset: 0;
    background: black;
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 999;
}

.soldado-card{
    padding:15px;
    display:flex;
    gap:15px;
    align-items:center;
    background: rgba(255,255,255,0.03);
}

</style>
</head>

<body>

<div id="loginScreen">
    <div style="width:350px;border:1px solid var(--tactical-green);padding:30px;">
        <h3>ACCESO MILITAR</h3>

        <input id="userEmail" type="email" class="auth-input" placeholder="EMAIL">
        <input id="userPass" type="password" class="auth-input" placeholder="CONTRASE√ëA">

        <button onclick="login()">INICIAR SESI√ìN</button>
    </div>
</div>

<div class="sidebar">

<div id="userName">...</div>
<div id="userRank">...</div>

<div class="menu-item" onclick="abrirAdminAuth()">ADMIN</div>

<button onclick="logout()">SALIR</button>

</div>

<div class="main-content">

<div id="adminTools">

<select id="targetSoldier" class="auth-input"></select>

<select id="targetRank" class="auth-input"></select>

<select id="targetAeronave" class="auth-input">
<option>F-16</option>
<option>F-22</option>
<option>BLACK HAWK</option>
<option>CHINOOK</option>
</select>

<button onclick="procesarCambiosAdmin()">ACTUALIZAR</button>

</div>

<div id="listaSoldados"></div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged }
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import {
getFirestore,
doc,
getDoc,
updateDoc,
collection,
getDocs
}
from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {

apiKey: "AIzaSyBYfZSISbpVShSfEA70vY1bANiyy40uVP4",
authDomain: "panel-chile.firebaseapp.com",
projectId: "panel-chile",
storageBucket: "panel-chile.appspot.com",
messagingSenderId: "124864601883",
appId: "1:124864601883:web:839163be2060253f68bdbe"

};

const app = initializeApp(firebaseConfig);

const auth = getAuth(app);

const db = getFirestore(app);



/* NUEVO SISTEMA COLOR DIVISION */
function getDivisionColor(division){

if(division==="FACH") return "#ffffff";

if(division==="BOE") return "#ff3b3b";

if(division==="ARMADA") return "#00a2ff";

return "#4df24d";

}



const RANGOS = [

"Cabo 2¬∞",
"Cabo 1¬∞",
"Sargento 2¬∞",
"Sargento 1¬∞",
"Suboficial",
"Suboficial Mayor",
"Subteniente",
"Teniente",
"Capit√°n",
"Mayor",
"Teniente Coronel",
"Coronel",
"General de Brigada",
"General de Divisi√≥n",
"General en Jefe"

];



onAuthStateChanged(auth, async(user)=>{

if(user){

const snap = await getDoc(doc(db,"usuarios",user.email));

if(snap.exists()){

document.getElementById("loginScreen").style.display="none";

document.getElementById("userName").innerText=snap.data().nombre;

document.getElementById("userRank").innerText=snap.data().rango;

cargarDatos();

}

}

});



async function cargarDatos(){

const snap = await getDocs(collection(db,"usuarios"));

const lista = document.getElementById("listaSoldados");

const sel = document.getElementById("targetSoldier");

const selRank = document.getElementById("targetRank");

lista.innerHTML="";
sel.innerHTML="";
selRank.innerHTML="";

RANGOS.forEach(r=>{

selRank.innerHTML+=`<option>${r}</option>`;

});

snap.forEach(docSnap=>{

const d = docSnap.data();

const email = docSnap.id;

const divisionColor = getDivisionColor(d.division);

sel.innerHTML+=`<option value="${email}">${d.nombre}</option>`;

lista.innerHTML+=`

<div class="soldado-card"

style="border:1px solid ${divisionColor};">

<div style="font-size:26px;color:${divisionColor};">üë§</div>

<div>

<div style="color:${divisionColor};font-weight:bold;">

${d.nombre}

</div>

<div style="color:${divisionColor};font-size:12px;">

${d.rango} // ${d.division||"EJERCITO"}

</div>

</div>

</div>

`;

});

}



window.procesarCambiosAdmin = async ()=>{

const email=document.getElementById("targetSoldier").value;

const rango=document.getElementById("targetRank").value;

const aeronave=document.getElementById("targetAeronave").value;

await updateDoc(doc(db,"usuarios",email),{

rango:rango,

aeronave:aeronave

});

alert("ACTUALIZADO");

cargarDatos();

};



window.login = async ()=>{

const e=document.getElementById("userEmail").value;

const p=document.getElementById("userPass").value;

await signInWithEmailAndPassword(auth,e,p);

};



window.logout=()=>{

signOut(auth);

location.reload();

};



window.abrirAdminAuth=()=>{

const code=prompt("CODIGO");

if(code==="CHILE2026"){

document.getElementById("adminTools").style.display="block";

}

};

</script>

</body>
</html>
